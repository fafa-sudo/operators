<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Sys</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            border: 5px solid #FF69B4;
            background-color: #c0e4ea;
        }

        h1 {
            background-color: #3515ed;
            padding: 10px;
            border-radius: 10px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0;
            text-align: center;
        }

        #loginHeader {
            display: flex;
            justify-content: space-between;
            display: flex;
             justify-content: space-between;
            text-align:center;
            /*display: inline-flex; */
            align-items: center; /* Vertically center items */
            font-size: 30px;
            margin-top: 5px;
            padding: 10px; /* Add some padding to prevent overflow on small screens */
            box-sizing: border-box; /* Include padding in width calculations */
        }

        #mainHeader {
            display: none;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 3px solid black; /* Sets a thick black border for the table, th and td */
        }

        th,
        td {
            border: 1px solid gray;
            padding: 10px;
            text-align: left;
            font-size: 22px;
            font-weight: bold;
            background-color: white;
           
        }

        th {
            background-color: #007BFF;
            color: white;
            border-bottom: 3px solid rgb(48, 233, 7); /* Thick bottom border for header cells */
        }

        .inputContainer {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
        }

        input[type="text"],
        input[type="password"],
        button {
            margin-bottom: 10px;
            width: auto;
            flex-grow: 1;
            flex: 1; /* Allow inputs to grow and fill the space */
            margin-right: 10px; /* Space between input fields and button */
            padding: 10px; /* Padding inside inputs */
        }

        button {
            cursor: pointer;
        }

        .deleteButton {
            background-color: #dc3545;
            color:black;
            border: none;
            border-radius: 5px;
        }
        .deleteButton:hover {
            background-color:red;
            color:white;
            border: black;
            border-radius: 5px;
            box-shadow:brown;
        }

        .editButton {
            background-color: #ffc107;
            color: black;
            border: none;
            border-radius: 5px;
        }
        .editButton:hover {
            background-color: #440bde;
            color: white;
            border: green;
            border-radius: 5px;
            box-shadow:blue;
        }

        .addButton {
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .addButton:hover {
            background-color:green;
            color: violet;
            border: none;
            border-radius: 5px;
            box-shadow:5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover {
            color: black;
            cursor: pointer;
        }

        #mainHeader {
            margin-bottom: 20px;
            text-align: center;
            position: relative; /* Position context for absolute elements */
        }

        .clock {
            font-size: 36px;
            font-weight: bold;
            margin-top: 10px;
        }

        .centered-text {
            text-align: center;
            margin: 0;
            font-size: 48px;
        }

        .hidden {
            display: none;
        }

        .nav-buttons {
            margin: 20px 0;
        }

        .nav-button {
            padding: 10px 20px;
            margin-right: 10px;
            color: white;
            background-color: #007BFF;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .nav-button:hover {
            background-color: #41e60e;
            color:black;
        }
        .duty-status {
            background-color: rgb(105, 197, 243);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .current-date,
        .selected-date {
            border-radius: 5px;
            color: rgb(88, 13, 218);
        }
        
        .selected-date {
            background-color: rgb(9, 181, 75);
            padding: 5px;
        }

        .current-date {
            background-color: rgb(174, 215, 25);
            padding: 5px;
        }

        .on-duty {
            background-color: yellow;
            padding: 5px;
            border-radius: 5px;
            color: black;
        }

        .off-duty {
            background-color: green;
            padding: 5px;
            border-radius: 5px;
            color: white;
        }
        .calculateButt {
            background-color: green;  /* Background color for button */
            color: white;             /* Text color */
            border: none;             /* No border */
            border-radius: 5px;      /* Rounded corners */
            padding: 10px;           /* Padding */
            cursor: pointer;          /* Cursor style */
            display: flex;            /* Align items horizontally */
            align-items: center;      /* Center items vertically */
            font-weight: bold; /* Bold text */
        }

        .button-icon {
            margin-right: 5px;       /* Space between icon and text */
            font-size: 1.2em;        /* Icon size */
            font-weight: bold; /* Bold text */
        }

        .calculateButt:hover {
            background-color: darkgreen; /* Darker shade on hover */
        }

        .duty-label {
            margin: 5px 0;
            font-weight: bold;
        }

        .gray-label {
            color: rgb(17, 21, 233);
            background-color: rgba(24, 25, 25, 0.381);
            font-size: 30px; /* Example font size */
        }
        .selecteddate {
            color: black; /* Text color */
            background-color: rgba(17, 166, 230, 0.381); /* Background color */
            font-size: 30px; /* Example font size */
            font-weight: bold; /* Bold text */
            padding: 10px; /* Optional padding for better appearance */
            border-radius: 5px; /* Optional rounded corners */
        }
        .dutystatus {
            background-color: rgb(212, 244, 172);
            padding: 15px;
            border-radius: 10px;
            color: rgb(5, 3, 11);
            margin: 30px 0;
        }
        .duty-status {
            background-color: rgb(105, 197, 243);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        #addCommentBtn:hover{
            box-shadow:#edcd13;
            transition-delay:1s ;
        }
        #operatorsButton {
            display: none; /* Initially hidden */
            transition: background-color 0.3s, border-color 0.3s, box-shadow 0.3s;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            background-color:white; /* Original blue */
            color: white; /* Text color */
            border: none; /* No border */
            border-radius: 5px; /* Rounded corners */
            padding: 10px;
            cursor: pointer; /* Pointer cursor */
            font-size: 16px; /* Font size */
            margin-bottom: 20px; /* Space below the button */
        }
        /* Hover Effects for the Operators Button */
        #operatorsButton:hover {
            border: 2px solid #ffc107;
            box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.3);
        }
        .tree-container {
            display: flex;
            justify-content: center; /* Center the images and clock */
            align-items: center;
            margin: 20px 0; /* Adjust the margin as needed */
            margin-bottom:35px;
            margin-top:35px;
        }

        .tree-left,
        .tree-right {
            width: 300px; /* Adjust the size as needed */
            height:100px;
        }

        .clock {
            font-size: 36px;
            font-weight: bold;
            margin: 0 20px; /* Space between the images and the clock */
            color: white; /* Set clock text color */
        }
        /*style for image positioning left and right*/
        #leftTree {
            position: absolute; /* Allow precise positioning */
            left: 0; /* Position at the left */
            /* Optionally, you can adjust width and height */
            /* width: 100px; /* Set a specific width */
            /* height: auto; /* Maintain aspect ratio */
        }
        #rightTree {
            position: absolute; /* Allow precise positioning */
            /*top: 0; /* Position at the top */
            right: 0; /* Position at the left */
            /* Optionally, you can adjust width and height */
            /* width: 100px; /* Set a specific width */
            /* height: auto; /* Maintain aspect ratio */
        }
        #clock {
            font-size: 36px;
            font-weight: bold;
            margin: 0 20px; /* Space between the images and the clock */
            color: white; /* Set clock text color */
            background-color:black;
            display:inline-block;
        }
        #username,#password,#loginButton{
            padding:10px;
            border:bold;
            justify-content: center; /* Center the images and clock */
            align-items: center;
            color:black;
            margin-top:3px;
            width:100%;
        }
        #loginButton{
            justify-content: center; /* Center the images and clock */
            align-items: center;
            color:black;  
            padding: 10px 10px;
            background-color: #12ca18; /* Button color */
            border: bold; /* Remove border */
            border-radius: 5px; /* Rounded corners */
            cursor: pointer; /* Pointer cursor on hover */
            margin-top:3px;
            box-shadow:#FF69B4;
            transition: box-shadow 0.1s ease; /* Smooth transition */

        }
        #loginButton:hover{
            color:black;  
            background-color:rgb(220, 196, 15);
        }
       #loginDiv{
            display:flex;
            background-color: white; /* Background for the login container */
            padding: 10px; /* Padding inside the div */
            border-radius: auto; /* Slightly rounded corners */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Subtle shadow */
            margin-top:8px; /* Maximum width of the container */
            width: 100%; /* Full width up to the max width */
            box-sizing: border-box; /* Include padding in width calculations */
            text-align:center;
            align-items:center;
        }
        .inputContainer {
            display:flex; /* Use flexbox */
            justify-content: space-between; /* Space between items */
            align-items: center; /* Center items vertically */
        }
        .small-image {
    width: 40px;    /* Set the width */
    height: auto;   /* Set the height */
    }
    #toggleButtonsBtn:hover{
        background-color:#edcd13;
        color:white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); /* Shadow effect */
        transition: box-shadow 0.3s ease; /* Smooth transition for shadow */
    }
    #toggleButtonsBtn{
        background-color:#51e62b;
        color:black;
        transition: box-shadow 0.5s ease; /* Smooth transition for shadow */
    }
    #backBtn {
        margin-top:0;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #007BFF;
            color: white;
            cursor: pointer;
            transition: box-shadow 0.3s ease;
            font-size:20px;
            font-weight:bold;
            /*animation: borderCycle 6s infinite; /* Animation for cycling border styles */
        }
        /* Keyframes for cycling border styles */
        /*@keyframes borderCycle {
            0% {
                border: 4px solid transparent; /* No border */
           /* }
            25% {
                border: 4px solid #FF5733; /* Red border */
           /* }
            50% {
                border: 4px solid #33FF57; /* Green border */
           /* }
            75% {
                border: 4px solid #3357FF; /* Blue border */
            /*}
            100% {
                border: 4px solid #FF33A1; /* Pink border */
           /* }
        }*/
        
        #backBtn:hover {
            background-color: #e1a90f;
            box-shadow: 5px 4px 15px rgba(0, 0, 0, 0.5);
            color:black;
        }
        #dutyInputContainer{
            display:flex; /* Use flexbox */
            justify-content: space-between; /* Space between items */
            align-items: center; /* Center items vertically */ 
            color:black;
            padding:20px;
        }
        #viewondutyBtn:hover{
            background-color:#3f10d7
        }
    </style>
</head>

<body>
    <div class="headlogin">
    <h1 id="loginHeader">Login Form to Get Teams <i class="fas fa-sign-in-alt"></i></h1>
</div>
    <div id="loginDiv">
        <div class="inputContainer">
            <input type="text" id="username" placeholder="username(operator)" />
            <input type="password" id="password" placeholder="Password" />
            <button type="button" id="loginButton"><i class="fas fa-sign-in-alt"></i> Login</button>
       
        <p id="loginMessage" class="errorMessage" style="color: red;"></p>
    </div>
</div>

    <header id="restrictedHeader" class="hidden">
        <h2 style="text-align: center; color: red;">RESTRICTED</h2>
    </header>

    <div id="mainHeader">
        <h1 class="centered-text" id="headofonduty">Operators On Duty</h1>
        <!--<div class="clock" id="clock"></div>-->
    </div>
     <!-- Back button (initially hidden) -->
     <button id="backBtn" style="display: none;">&#8592; Back</button>
    <!-- Button to toggle the visibility of the nav-buttons -->
<button id="toggleButtonsBtn" style="display:none;background:#12ca18;font-size:26px;font-weight:bold"><i class="fas fa-users" style="font-size:30px; color:black"></i>OPERATORS</button>
    <div id="tablesDiv" class="hidden">
        <div class="nav-buttons" style="display: none;">
            <button class="nav-button" id="viewMembersBtn"><i class="fas fa-users"></i> View Team Members</button>
            <button class="nav-button" id="viewDutiesBtn"><i class="fas fa-calendar-alt"></i> View Weekly Duties</button>
            <button class="nav-button" id="viewCommentsBtn"><i class="fas fa-comments"></i> View Comments</button>
            <button class="nav-button" id="viewDutyStatusBtn"><i class="fas fa-clock"></i> View Duty Status</button>
            <!--onduty-->
            <button class="nav-button" id="viewondutyBtn"><i class="fas fa-user-check"></i> View Schedule Shifts</button>
        </div>
        <!-- Operators Section -->
        <div class="operators-section" id="membersSection">
            <h1>Operators' Team Members</h1>
            <div id="teamSections">
                <h2>Team A1</h2>
                <div class="inputContainer" id="teamA1Inputs">
                    <input type="text" id="teamA1Rank" placeholder="Rank" />
                    <input type="text" id="teamA1FirstName" placeholder="First Name" />
                    <input type="text" id="teamA1LastName" placeholder="Last Name" />
                    <input type="text" id="teamA1Remark" placeholder="Remark" />
                    <input type="text" id="teamA1Comment" placeholder="Comment" />
                    <button class="addButton" id="addTeamA1Btn"><i class="fas fa-plus"></i> Add</button>
                </div>
                <table id="tableTeamA1">
                    <thead>
                        <tr>
                            <th>S/No</th>
                            <th>Rank</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Remark</th>
                            <th>Comment</th>
                            <th class="actionCol">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membersTeamA1"></tbody>
                </table>

                <h2>Team A2</h2>
                <div class="inputContainer" id="teamA2Inputs">
                    <input type="text" id="teamA2Rank" placeholder="Rank" />
                    <input type="text" id="teamA2FirstName" placeholder="First Name" />
                    <input type="text" id="teamA2LastName" placeholder="Last Name" />
                    <input type="text" id="teamA2Remark" placeholder="Remark" />
                    <input type="text" id="teamA2Comment" placeholder="Comment" />
                    <button class="addButton" id="addTeamA2Btn"><i class="fas fa-plus"></i> Add</button>
                </div>
                <table id="tableTeamA2">
                    <thead>
                        <tr>
                            <th>S/No</th>
                            <th>Rank</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Remark</th>
                            <th>Comment</th>
                            <th class="actionCol">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membersTeamA2"></tbody>
                </table>

                <h2>Team B1</h2>
                <div class="inputContainer" id="teamB1Inputs">
                    <input type="text" id="teamB1Rank" placeholder="Rank" />
                    <input type="text" id="teamB1FirstName" placeholder="First Name" />
                    <input type="text" id="teamB1LastName" placeholder="Last Name" />
                    <input type="text" id="teamB1Remark" placeholder="Remark" />
                    <input type="text" id="teamB1Comment" placeholder="Comment" />
                    <button class="addButton" id="addTeamB1Btn"><i class="fas fa-plus"></i> Add</button>
                </div>
                <table id="tableTeamB1">
                    <thead>
                        <tr>
                            <th>S/No</th>
                            <th>Rank</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Remark</th>
                            <th>Comment</th>
                            <th class="actionCol">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membersTeamB1"></tbody>
                </table>

                <h2>Team B2</h2>
                <div class="inputContainer" id="teamB2Inputs">
                    <input type="text" id="teamB2Rank" placeholder="Rank" />
                    <input type="text" id="teamB2FirstName" placeholder="First Name" />
                    <input type="text" id="teamB2LastName" placeholder="Last Name" />
                    <input type="text" id="teamB2Remark" placeholder="Remark" />
                    <input type="text" id="teamB2Comment" placeholder="Comment" />
                    <button class="addButton" id="addTeamB2Btn"><i class="fas fa-plus"></i> Add</button>
                </div>
                <table id="tableTeamB2">
                    <thead>
                        <tr>
                            <th>S/No</th>
                            <th>Rank</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Remark</th>
                            <th>Comment</th>
                            <th class="actionCol">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membersTeamB2"></tbody>
                </table>
            </div>
        </div>

        <!-- Weekly Duty Management Section -->
        <div id="dutyManagementSection" class="hidden">
            <h1>Weekly <strong>Time Table</strong> Teams on Duty</h1>
            <div class="inputContainer" id="dutyInputContainer">
                <input type="text" id="weekDay" placeholder="Week Day" />
                <input type="date" id="date" style="font-size:24px;height:32px;margin-bottom:10px" />
                <input type="text" id="dayShift" placeholder="Day Shift" />
                <input type="text" id="nightShift" placeholder="Night Shift" />
                <input type="text" id="offDuty" placeholder="Off Duty" />
                <button type="button" id="addDutyBtn" class="addButton"><i class="fas fa-plus"></i> Add</button>
            </div>
            <table id="dutyTable" style="margin-top:10px">
                <thead>
                    <tr>
                        <th>S/No</th>
                        <th>Week Day</th>
                        <th>Date</th>
                        <th>Day Shift</th>
                        <th>Night Shift</th>
                        <th>Off Duty</th>
                        <th class="actionCol">Actions</th>
                    </tr>
                </thead>
                <tbody id="dutyList"></tbody>
            </table>
        </div>

        <!-- Comment View -->
        <div id="commentViewSection" class="hidden">
            <h1>Comment</h1>
            <div class="inputContainer" id="commentInputContainer">
                <input type="text" id="comment" placeholder="Enter your comment" />
                <input type="text" id="writtenBy" placeholder="Written By" />
                <button type="button" id="addCommentBtn" class="addButton"><i class="fas fa-plus"></i> Add Comment</button>
            </div>
            <table id="commentTable" style="margin-top:10px">
                <thead>
                    <tr>
                        <th>S/No</th>
                        <th>Comment</th>
                        <th>Written By</th>
                        <th class="actionCol">Actions</th>
                    </tr>
                </thead>
                <tbody id="commentList"></tbody>
            </table>

            <div id="editCommentModal" class="modal">
                <div class="modal-content">
                    <span class="close" id="closeCommentEditModal">×</span>
                    <h2>Edit Comment</h2>
                    <input type="text" id="editComment" placeholder="Comment" />
                    <input type="text" id="editWrittenBy" placeholder="Written By" />
                    <button id="saveCommentEditBtn">Save</button>
                </div>
            </div>
        </div>
        
        <!-- Duty Status Section -->
        <div id="dutyStatusSection" class="hidden">
            <h1>Duty Status</h1>
            <div class="duty-status">
                <label for="dateInput" style="font-size: 32px; font-weight:bold; color: rgb(139, 55, 6);">Select a date:</label>
                <input style="padding:10px; height:18px;width:auto;font-size:28px;color:black" type="date" id="dateInput" />
                <br><br>
                <button type="button" id="calculateBtn" class="addButton">
                    <i class="fas fa-calculator button-icon"></i> CALCULATE
                </button>
                <br><br>
                <div id="currentDateLabel" class="gray-label"></div>
                <div id="result" class="selecteddate"></div>
            </div>
        </div>
    </div>

        <!-- Operators On Duty Section -->
        <div id="ondutysection" class="hidden">
            <!--<h1 class="centered-text">Operators On Duty</h1>
            <p class="clock" id="clock"></p>-->
            <h1 ><img  id="imagesize" src=" https://github.com/fafa-sudo/picture/blob/main/RAF_spectral.jpg?raw=true" alt="" class="small-image"><strong>Operators On Duty</strong><img src="https://github.com/fafa-sudo/picture/blob/main/Radar_scan.jpg?raw=true" alt="" class="small-image"></h1> <!-- Initially hidden -->
            <div class="tree-container">
                <!-- Add tree images -->
                <img src="https://raw.githubusercontent.com/fafa-sudo/picture/main/LTR25.png" alt="Tree Left" class="tree-left" id="leftTree" style="margin-left:15px">
                <div class="clock" id="clock"></div>
                <img src="https://raw.githubusercontent.com/fafa-sudo/picture/main/ACCS.png" alt="Tree Right" class="tree-right" id="rightTree" style="margin-right:15px">
            </div>

            <div id="addOperatorContainer" class="inputContainer">
                <input type="text" id="shift" placeholder="Shift" />
                <input type="text" id="soOperator" placeholder="SV Operator" />
                <input type="text" id="idOperator" placeholder="ID Operator" />
                <input type="text" id="supervisor" placeholder="Supervisor" />
                <input type="text" id="remark" placeholder="Remark" />
                <button type="button" id="addOperatorBtn" class="addButton"><i class="fas fa-plus"></i> Add</button>
            </div>

            <table id="tableOperators">
                <thead>
                    <tr>
                        <th>S/No</th>
                        <th>Shift</th>
                        <th>SV Operator</th>
                        <th>ID Operator</th>
                        <th>Supervisor</th>
                        <th>Remark</th>
                        <th class="actionColumn">Actions</th>
                    </tr>
                </thead>
                <tbody id="operatorsList"></tbody>
            </table>

            <div id="editModal" class="modal">
                <div class="modal-content">
                    <span class="close">×</span>
                    <h2>Edit Operator</h2>
                    <input type="text" id="editShift" placeholder="Shift" />
                    <input type="text" id="editSOOperator" placeholder="SV Operator" />
                    <input type="text" id="editIDOperator" placeholder="ID Operator" />
                    <input type="text" id="editSupervisor" placeholder="Supervisor" />
                    <input type="text" id="editRemark" placeholder="Remark" />
                    <button id="saveEditBtn">Save</button>
                </div>
            </div>
        </div>
    

    <footer id="restrictedFooter" class="hidden">
        <p style="text-align: center;font-weight:bold;font-size:24px; color: red;">RESTRICTED</p>
    </footer>

    <script type="module">
        // Initialize Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDbm1ApKMcu9Q8HwJwKqROgBNndtr1Vl_8",
            authDomain: "tstdb-8e676.firebaseapp.com",
            databaseURL: "https://tstdb-8e676-default-rtdb.firebaseio.com",
            projectId: "tstdb-8e676",
            storageBucket: "tstdb-8e676.appspot.com",
            messagingSenderId: "995214869280",
            appId: "1:995214869280:web:58ce365c970bd53300cd45"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentEditId = '';  // ID of the currently edited operator
        let currentEditCommentId = '';  // ID of the currently edited comment
        let currentDutyEditId = ''; // ID of the currently edited duty
        let userRole = '';
        // Load operators onduty
        function loadOperators() {
            onSnapshot(collection(db, "operatorsOnDuty"), snapshot => {
                const operators = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderOperators(operators);
            });
        }//onduty


// Handle Login Button Click
document.getElementById('loginButton').addEventListener('click', async () => {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    // Simulated login and role check
    if (username && password) {
        userRole = username; // Allow username to determine the role
        setUserInterfaceForRole(userRole); // Set the UI based on user role

        // Load data for member, duties, and comments
        ['teamA1', 'teamA2', 'teamB1', 'teamB2'].forEach(team => loadMembersForTeam(team));
        loadDuties();
        loadComments();
        loadOperators();
    } else {
        document.getElementById('loginMessage').innerText = 'Invalid username or password.';
        return;
    }
});

// Function to set user interface based on role
function setUserInterfaceForRole(role) {
    document.getElementById('loginHeader').style.display = 'none';//hide login h1 toggleButtonsBtn
    document.getElementById('toggleButtonsBtn').style.display = 'block';//show toggleButtonsBtn
    document.getElementById('loginDiv').classList.add('hidden'); // Hide the login form
    document.getElementById('mainHeader').style.display = 'block';
    document.getElementById('tablesDiv').classList.remove('hidden');
    document.getElementById('headofonduty').classList.add('hidden');
    document.getElementById('restrictedHeader').classList.remove('hidden');
    document.getElementById('restrictedFooter').classList.remove('hidden');

    const inputContainers = document.querySelectorAll('.inputContainer');
    const actionCols = document.querySelectorAll('.actionCol');

    // Set permissions based on user role
    if (role === 'admin') {
        // Admin has full access
        inputContainers.forEach(container => {
            container.style.display = 'flex'; // Show all input containers
        });
        actionCols.forEach(col => {
            col.style.display = ''; // Show all action columns
        });
    } else if (role === 'supervisor' || role === 'operator') {
        // Hide input fields and actions for all tables except the comment table
        inputContainers.forEach((container, index) => {
            // Check if the index corresponds to comment input (adjust if needed)
            if (index <= 12) {
                container.style.display = 'none'; // Hide input containers for non-comment tables
            }
        });

        actionCols.forEach((col, index) => {
            if (index <= 12) {
                col.style.display = 'none'; // Hide action columns for non-comment tables
            }
        });

        // Hide comment controls for operator
        if (role === 'operator') {
            const commentInputContainer = document.querySelector('#commentViewSection .inputContainer');
            commentInputContainer.style.display = 'none'; // Hide comment input controls

            const commentActionCols = document.querySelectorAll('#commentTable .actionCol');
            commentActionCols.forEach(col => {
            col.style.display = 'none'; // Hide action columns for comment table
            });
        }

        // Show comment controls for supervisor
        if (role === 'supervisor') {
            const commentInputContainer = document.querySelector('#commentViewSection .inputContainer');
            commentInputContainer.style.display = 'flex'; // Show comment input controls

            const commentActionCols = document.querySelectorAll('#commentTable .actionCol');
            commentActionCols.forEach(col => {
                col.style.display = ''; // Show action columns for comment table
            });
        }
    }
}

        // Load team members from Firestore
        const loadMembersForTeam = (team) => {
            onSnapshot(collection(db, team), snapshot => {
                const members = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderMembers(members, team);
            });
        };

        const renderMembers = (members, team) => {
            const tbody = document.getElementById(`members${team.charAt(0).toUpperCase() + team.slice(1)}`);
            tbody.innerHTML = '';
            members.forEach((member, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${member.rank}</td>
                    <td>${member.firstName}</td>
                    <td>${member.lastName}</td>
                    <td>${member.remark || ''}</td>
                    <td>${member.comment || ''}</td>
                    <td class="actionCol" style="${userRole === 'operator' || userRole === 'supervisor' ? 'display:none;' : ''}">
                        <button class="editButton" data-id="${member.id}" data-team="${team}"><i class="fas fa-edit"></i> Edit</button>
                        <button class="deleteButton" data-id="${member.id}" data-team="${team}"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            attachEditDeleteListeners(); // Attach listeners to new entries
        };

        const attachEditDeleteListeners = () => {
            const editButtons = document.querySelectorAll('.editButton');
            const deleteButtons = document.querySelectorAll('.deleteButton');

            editButtons.forEach(button => {
                button.addEventListener('click', async (event) => {
                    const memberId = event.target.dataset.id;
                    const team = event.target.dataset.team;

                    const memberRef = doc(db, team, memberId);
                    const memberSnap = await getDoc(memberRef);
                    const member = memberSnap.data();

                    document.getElementById(`${team}Rank`).value = member.rank;
                    document.getElementById(`${team}FirstName`).value = member.firstName;
                    document.getElementById(`${team}LastName`).value = member.lastName;
                    document.getElementById(`${team}Remark`).value = member.remark;
                    document.getElementById(`${team}Comment`).value = member.comment;

                    currentEditId = memberId;
                    document.querySelector(`#${team}Inputs .addButton`).innerText = "Update"; // Change button text to Update
                });
            });

            deleteButtons.forEach(button => {
                button.addEventListener('click', async (event) => {
                    const memberId = event.target.dataset.id;
                    const team = event.target.dataset.team;

                    if (confirm("Are you sure you want to delete this member?")) {
                        await deleteDoc(doc(db, team, memberId));
                    }
                });
            });
        };

        // Add or Update Team Members
        const addTeamMember = async (team) => {
            const memberData = {
                rank: document.getElementById(`${team}Rank`).value,
                firstName: document.getElementById(`${team}FirstName`).value,
                lastName: document.getElementById(`${team}LastName`).value,
                remark: document.getElementById(`${team}Remark`).value,
                comment: document.getElementById(`${team}Comment`).value,
            };

            if (currentEditId) {
                // Update existing member
                await updateDoc(doc(db, team, currentEditId), memberData);
                alert("Member updated successfully!");
                clearFields(team);
                currentEditId = ''; // Reset after update
                document.querySelector(`#${team}Inputs .addButton`).innerText = "Add"; // Reset button text
            } else {
                // Add new member
                if (memberData.rank && memberData.firstName && memberData.lastName) {
                    await addDoc(collection(db, team), memberData);
                    alert("Member added successfully!");
                    clearFields(team);
                } else {
                    alert('All fields are required.');
                }
            }
        };

        // Event listeners for adding members in different teams
        document.getElementById('addTeamA1Btn').addEventListener('click', () => addTeamMember('teamA1'));
        document.getElementById('addTeamA2Btn').addEventListener('click', () => addTeamMember('teamA2'));
        document.getElementById('addTeamB1Btn').addEventListener('click', () => addTeamMember('teamB1'));
        document.getElementById('addTeamB2Btn').addEventListener('click', () => addTeamMember('teamB2'));

        // Clear input fields function
        const clearFields = (team) => {
            document.getElementById(`${team}Rank`).value = '';
            document.getElementById(`${team}FirstName`).value = '';
            document.getElementById(`${team}LastName`).value = '';
            document.getElementById(`${team}Remark`).value = '';
            document.getElementById(`${team}Comment`).value = '';
            document.querySelector(`#${team}Inputs .addButton`).innerText = "Add"; // Reset button text
        };

        // Duty Management
        const loadDuties = () => {
            onSnapshot(collection(db, "duties"), snapshot => {
                const duties = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderDuties(duties);
            });
        };

        const renderDuties = (duties) => {
            const tbody = document.getElementById('dutyList');
            tbody.innerHTML = '';
            duties.forEach((duty, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${duty.weekDay}</td>
                    <td>${new Date(duty.date).toLocaleDateString()}</td>
                    <td>${duty.dayShift}</td>
                    <td>${duty.nightShift}</td>
                    <td>${duty.offDuty}</td>
                    <td class="actionCol" style="${(userRole === 'supervisor' || userRole === 'operator') ? 'display:none;' : ''}">
                        <button class="editButton" data-id="${duty.id}"><i class="fas fa-edit"></i> Edit</button>
                        <button class="deleteButton" data-id="${duty.id}"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            attachDutyEditDeleteListeners(); // Attach listeners to new entries
        };

        const attachDutyEditDeleteListeners = () => {
            const editButtons = document.querySelectorAll('#dutyList .editButton');
            const deleteButtons = document.querySelectorAll('#dutyList .deleteButton');

            editButtons.forEach(button => {
                button.addEventListener('click', async (event) => {
                    const dutyId = event.target.dataset.id;
                    const dutyRef = doc(db, "duties", dutyId);
                    const dutySnap = await getDoc(dutyRef);
                    const duty = dutySnap.data();

                    document.getElementById('weekDay').value = duty.weekDay;
                    document.getElementById('date').value = duty.date;
                    document.getElementById('dayShift').value = duty.dayShift;
                    document.getElementById('nightShift').value = duty.nightShift;
                    document.getElementById('offDuty').value = duty.offDuty;

                    currentDutyEditId = dutyId; // Track the current duty ID for editing
                    document.getElementById('addDutyBtn').innerText = "Update"; // Change button text to Update
                });
            });

            deleteButtons.forEach(button => {
                button.addEventListener('click', async (event) => {
                    const dutyId = event.target.dataset.id;
                    if (confirm("Are you sure you want to delete this duty entry?")) {
                        await deleteDoc(doc(db, "duties", dutyId));
                    }
                });
            });
        };

        // Add or Update Duty
        document.getElementById('addDutyBtn').addEventListener('click', async () => {
            const dutyData = {
                weekDay: document.getElementById('weekDay').value,
                date: document.getElementById('date').value,
                dayShift: document.getElementById('dayShift').value,
                nightShift: document.getElementById('nightShift').value,
                offDuty: document.getElementById('offDuty').value,
            };

            if (currentDutyEditId) {
                // Update existing duty
                await updateDoc(doc(db, 'duties', currentDutyEditId), dutyData);
                alert("Duty updated successfully!");
                clearDutyFields();
                currentDutyEditId = ''; // Reset after update
                document.getElementById('addDutyBtn').innerText = "Add"; // Reset button text
            } else {
                // Add new duty
                if (dutyData.weekDay && dutyData.date && dutyData.dayShift && dutyData.nightShift) {
                    await addDoc(collection(db, 'duties'), dutyData);
                    alert("Duty added successfully!");
                    clearDutyFields();
                } else {
                    alert('All fields are required.');
                }
            }
            loadDuties();
        });

        // Clear Duty fields
        const clearDutyFields = () => {
            document.getElementById('weekDay').value = '';
            document.getElementById('date').value = '';
            document.getElementById('dayShift').value = '';
            document.getElementById('nightShift').value = '';
            document.getElementById('offDuty').value = '';
            document.getElementById('addDutyBtn').innerText = "Add"; // Reset button text
        };

        // Comment Management
        const loadComments = () => {
            onSnapshot(collection(db, "comments"), snapshot => {
                const comments = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderComments(comments);
            });
        };

        const renderComments = (comments) => {
            const tbody = document.getElementById('commentList');
            tbody.innerHTML = '';
            comments.forEach((comment, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${comment.comment}</td>
                    <td>${comment.writtenBy}</td>
                    <td class="actionCol" style="${(userRole === 'operator') ? 'display:none;' : ''}">
                        <button class="editButton" data-id="${comment.id}" style="${(userRole === 'admin' || userRole === 'supervisor') ? '' : 'display:none;'}"><i class="fas fa-edit"></i> Edit</button>
                        <button class="deleteButton" data-id="${comment.id}" style="${(userRole === 'admin' || userRole === 'supervisor') ? '' : 'display:none;'}"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            attachCommentEditDeleteListeners(); // Attach listeners to new entries
        };

        const attachCommentEditDeleteListeners = () => {
            const editButtons = document.querySelectorAll('#commentList .editButton');
            const deleteButtons = document.querySelectorAll('#commentList .deleteButton');

            editButtons.forEach(button => {
                button.addEventListener('click', async (event) => {
                    const commentId = event.target.dataset.id;
                    const commentRef = doc(db, "comments", commentId);
                    const commentSnap = await getDoc(commentRef);
                    const comment = commentSnap.data();

                    document.getElementById('editComment').value = comment.comment;
                    document.getElementById('editWrittenBy').value = comment.writtenBy;

                    currentEditCommentId = commentId; // Store ID for updating
                    document.getElementById('editCommentModal').style.display = 'block';
                });
            });

            deleteButtons.forEach(button => {
                button.addEventListener('click', async (event) => {
                    const commentId = event.target.dataset.id;
                    if (confirm("Are you sure you want to delete this comment?")) {
                        await deleteDoc(doc(db, 'comments', commentId));
                    }
                });
            });
        };

        // Add or Update Comment
        document.getElementById('addCommentBtn').addEventListener('click', async () => {
            const commentData = {
                comment: document.getElementById('comment').value,
                writtenBy: document.getElementById('writtenBy').value,
            };

            if (currentEditCommentId) {
                // Update existing comment
                await updateDoc(doc(db, 'comments', currentEditCommentId), commentData);
                alert("Comment updated successfully!");
                clearCommentFields();
                currentEditCommentId = ''; // Reset after update
            } else {
                // Add new comment
                if (commentData.comment && commentData.writtenBy) {
                    await addDoc(collection(db, 'comments'), commentData);
                    alert("Comment added successfully!");
                    clearCommentFields();
                } else {
                    alert('All fields are required.');
                }
            }
            loadComments();
        });

        // Clear Comment fields
            const clearCommentFields = () => {
            document.getElementById('comment').value = '';
            document.getElementById('writtenBy').value = '';
        };

        // Handle Comment Edit
        document.getElementById('commentViewSection').addEventListener('click', async (event) => {
            const target = event.target.closest('button');
            if (target) {
                const id = target.getAttribute('data-id');
                if (target.classList.contains('deleteButton')) {
                    if (confirm("Are you sure you want to delete this comment?")) {
                        await deleteDoc(doc(db, 'comments', id));
                    }
                } else if (target.classList.contains('editButton')) {
                    const docRef = doc(db, 'comments', id);
                    const docSnap = await getDoc(docRef);
                    const comment = docSnap.data();

                    document.getElementById('editComment').value = comment.comment;
                    document.getElementById('editWrittenBy').value = comment.writtenBy;

                    currentEditCommentId = id;
                    document.getElementById('editCommentModal').style.display = 'block';
                }
            }
        });

        // Save changes for comments
        document.getElementById('saveCommentEditBtn').addEventListener('click', async () => {
            if (currentEditCommentId) {
                const updatedData = {
                    comment: document.getElementById('editComment').value,
                    writtenBy: document.getElementById('editWrittenBy').value,
                };

                await updateDoc(doc(db, 'comments', currentEditCommentId), updatedData);
                clearCommentEditFields();
                document.getElementById('editCommentModal').style.display = 'none';
                loadComments(); // Reload comments to reflect changes
            }
        });

        const clearCommentEditFields = () => {
            document.getElementById('editComment').value = '';
            document.getElementById('editWrittenBy').value = '';
        };

        document.getElementById('closeCommentEditModal').onclick = function () {
            document.getElementById('editCommentModal').style.display = 'none';
        };

        // Duty Status Calculation
       document.getElementById('calculateBtn').addEventListener('click', function() {
            const inputDate = document.getElementById("dateInput").value;
            const parsedDate = new Date(inputDate);

            if (!isNaN(parsedDate)) {
                const dayOfWeek = parsedDate.toLocaleDateString(undefined, { weekday: 'long' });
                const dutyStatus = getDutyStatus(parsedDate);
                document.getElementById("result").innerHTML = `<br>
                    <span class="blue-text">The selected date: <strong class="selected-date">${inputDate}</strong> (${dayOfWeek})</span><br><br>
                   ${dutyStatus}`;
            } else {
                document.getElementById("result").innerHTML = "Invalid date.";
            }
        });

        function getGroupStatus(dayIndex, groupName) {
            let groupStatusHTML = `<br><br>`;
            if (dayIndex === 0 || dayIndex === 2) {
                groupStatusHTML += `<label class="duty-label off-duty">${groupName}1: Off duty</label><br><br>
                                    <label class="duty-label off-duty">${groupName}2: Off duty</label><br><br>`;
            } else if (dayIndex === 1) {
                groupStatusHTML += `<label class="duty-label on-duty">${groupName}1: On duty during the Day</label><br><br>
                                    <label class="duty-label on-duty">${groupName}2: On duty during the Night</label><br><br>`;
            } else if (dayIndex === 3) {
                groupStatusHTML += `<label class="duty-label on-duty">${groupName}1: On duty during the Night</label><br><br>
                                    <label class="duty-label on-duty">${groupName}2: On duty during the Day</label><br><br>`;
            }
            return groupStatusHTML;
        }

        function getDutyStatus(date) {
            const startDate1 = new Date(2024, 1, 13); // TEAM A starts duty
            const startDate2 = new Date(2024, 1, 14); // TEAM B starts duty

            const difference1 = date - startDate1;
            const difference2 = date - startDate2;

            const daysDifference1 = Math.floor(difference1 / (1000 * 60 * 60 * 24));
            const daysDifference2 = Math.floor(difference2 / (1000 * 60 * 60 * 24));

            const cycleLength = 4; // Number of days in the duty cycle
            const dayIndex1 = daysDifference1 % cycleLength;
            const dayIndex2 = daysDifference2 % cycleLength;

            const TEAMAStatus = getGroupStatus(dayIndex1, "TEAM A");
            const TEAMBStatus = getGroupStatus(dayIndex2, "TEAM B");

            return `${TEAMAStatus}<br>${TEAMBStatus}`;
        }

        // Call the function to display the current date on page load
        displayCurrentDate();

        // Display the current date
        function displayCurrentDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const today = new Date();
            const formattedDate = today.toLocaleDateString(undefined, options);
            document.getElementById("currentDateLabel").innerText = `Today's date is on the ${formattedDate}`;
        }
        // Section Navigation
        const sections = ['membersSection', 'dutyManagementSection', 'commentViewSection', 'dutyStatusSection', 'ondutysection'];

        sections.forEach(section => {
            document.getElementById(section).classList.add('hidden');
        });

        // Section displaying logic
        const toggleSections = (activeSection) => {
            sections.forEach(section => {
                if (section === activeSection) {
                    document.getElementById(section).classList.remove('hidden');
                } else {
                    document.getElementById(section).classList.add('hidden');
                }
            });
        };

        document.getElementById('viewMembersBtn').addEventListener('click', () => toggleSections('membersSection'));
        document.getElementById('viewDutiesBtn').addEventListener('click', () => toggleSections('dutyManagementSection'));
        document.getElementById('viewCommentsBtn').addEventListener('click', () => toggleSections('commentViewSection'));
        document.getElementById('viewDutyStatusBtn').addEventListener('click', () => toggleSections('dutyStatusSection'));
        // onduty
        document.getElementById('viewondutyBtn').addEventListener('click', () => toggleSections('ondutysection'));

        document.getElementById('closeCommentEditModal').onclick = function () {
        document.getElementById('editCommentModal').style.display = 'none';
        };
        // Handle the "All Buttons" toggle || creating variables for each section table or button |||
        let isLoggedIn = false; // Variable to track login status
        const toggleButtonsBtn = document.getElementById('toggleButtonsBtn');
        const navButtons = document.querySelector('.nav-buttons');
        const backBtn = document.getElementById('backBtn'); // back button
        
    // Handle the "All Buttons" toggle
    toggleButtonsBtn.addEventListener('click', function() {
        // Hide the "All Buttons" button and show the navigation buttons
        toggleButtonsBtn.style.display = 'none'; // Hide "All Buttons"
        navButtons.style.display = 'block'; // Show navigation buttons
        backBtn.style.display = 'block'; // Show the Back button   
    });

    // Handle each nav-button click
        document.querySelectorAll('.nav-button').forEach(button => {
        button.addEventListener('click', function() {
        console.log(`Button clicked: ${this.innerText.trim()}`);
            // Additional actions based on which button was clicked can be implemented here
        });
    });

    // testing all buttons click on |||
     // Define the sections to hide
const section = [
    'membersSection',
    'dutyManagementSection',
    'commentViewSection',
    'dutyStatusSection',
    'ondutysection'  // Include any other sections you want to hide
];

// Handle the "All Buttons" toggle
toggleButtonsBtn.addEventListener('click', function() {
    // Hide all sections
    section.forEach(section => {
        document.getElementById(section).classList.add('hidden'); // or style.display = 'none'
    });

    // Hide the navigation buttons
    navButtons.style.display = 'block'; // Hide navigation buttons

    // Show the relevant controls: 
    backBtn.style.display = 'block'; // Show the Back button
});
    // end of testing on all buttons click |||

   // Handle the Back button click
    backBtn.addEventListener('click', function() {
        // Hide navigation buttons and show the "All Buttons" button
        navButtons.style.display = 'none'; // Hide navigation buttons
        toggleButtonsBtn.style.display = 'block'; // Show "All Buttons"
        backBtn.style.display = 'none'; // Hide the Back button
    });


    //code for handling back button start
     // Define the states of the button
     const buttonStates = [
            {
                text: '&#8592; Back', // First state (Back)
                action: function() {
                    //alert('Going back...');
                }
            },
            {
                text: '&#8596; Refresh', // Second state (Refresh)
                action: function() {
                    //alert('Refreshing...');
                }
            },
            {
                text: '&#8594; Next', // Third state (Next)
                action: function() {
                   // alert('Going next...');
                }
            }
        ];

        let currentStateIndex = 0; // Start at the first state

        // Get the button element
        const backbtn = document.getElementById('backBtn');

        // Set initial state
        backbtn.innerHTML = buttonStates[currentStateIndex].text;

        // Handle button clicks
        backbtn.addEventListener('click', function() {
            // Run the current state's action
            buttonStates[currentStateIndex].action();

            // Move to the next state, wrapping around if necessary
            currentStateIndex = (currentStateIndex + 1) % buttonStates.length;

            // Update button text
            backbtn.innerHTML = buttonStates[currentStateIndex].text;
        });
    //end of code for handlig back button
        // operators on duty js sections
          // Render Operators
        function renderOperators(operators) {
            const tbody = document.getElementById('operatorsList');
            tbody.innerHTML = ''; // Clear existing operators
            operators.forEach((operator, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${operator.shift}</td>
                    <td>${operator.soOperator}</td>
                    <td>${operator.idOperator}</td>
                    <td>${operator.supervisor || ''}</td>
                    <td>${operator.remark || ''}</td>
                    <td class="actionColumn">
                        <button class="editButton" data-id="${operator.id}"><i class="fas fa-edit"></i> Edit</button>
                        <button class="deleteButton" data-id="${operator.id}"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            toggleActionColumn(userRole); // Call to toggle actions based on user
        }

        function toggleActionColumn(userRole) {
            const actionColumns = document.querySelectorAll('.actionColumn');
            const addOperatorContainer = document.getElementById('addOperatorContainer');

            if (userRole === 'operator' || userRole === 'admin') {
                actionColumns.forEach(column => column.style.display = 'none'); // Hide action columns for onduty
                addOperatorContainer.style.display = 'none'; // Hide add operator section for onduty
            } else {
                actionColumns.forEach(column => column.style.display = 'table-cell'); // Show action columns for supervisor
                addOperatorContainer.style.display = 'flex'; // Show add operator section for supervisor
            }
        }

        // Handle Login Button Click
        document.getElementById('loginButton').addEventListener('click', () => {
            const username = document.getElementById('username').value,
                password = document.getElementById('password').value;

            // Simulated login for supervisor, admin, and operator
            if (username === 'supervisor' && password === 'supervisor') {
                userRole = 'supervisor';
                loginSuccess();
            } else if (username === 'operator' && password === 'operator') {
                userRole = 'operator';
                loginSuccess();
            } else if (username === 'admin' && password === 'admin') {
                userRole = 'admin';
                loginSuccess();
            } else {
                document.getElementById('loginMessage').innerText = 'Invalid username or password.';
            }
            toggleActionColumn(userRole); // Adjust UI based on user role
        });

        function loginSuccess() {
            document.getElementById('loginDiv').style.display = 'none';
            document.getElementById('loginHeader').style.display = 'none'; // Hide login header
            document.getElementById('mainHeader').style.display = 'block';

            // Change background to include the image after login
            document.body.style.backgroundImage = "url('https://github.com/fafa-sudo/picture/blob/main/RAF_spectral.jpg?raw=true')";
            //document.body.style.backgroundSize = "cover"; // Ensure it covers the full background
            document.body.style.backgroundSize = "80%"; // This zooms out the image
            document.body.style.backgroundRepeat = "no-repeat"; // Prevent repeating
            document.body.style.backgroundPosition = "center"; // Center the background image

            // Show the tree images
            document.getElementById('leftTree').style.display = 'block';
            document.getElementById('rightTree').style.display = 'block';

            // Show the Operators header
            document.getElementById('operatorsHeader').style.display = 'block';

            document.getElementById('operatorsButton').style.display = 'block'; // Show the operators button
            document.getElementById('tablesDiv').style.display = 'block';
            loadOperators();
            document.getElementById('editModal').style.display = 'none'; // Ensure edit modal is hidden after logging in
        }

        // Add Operator
        // Add Operator
        document.getElementById('addOperatorBtn').addEventListener('click', async () => {
            const operatorData = {
                shift: document.getElementById('shift').value,
                soOperator: document.getElementById('soOperator').value,
                idOperator: document.getElementById('idOperator').value,
                supervisor: document.getElementById('supervisor').value,
                remark: document.getElementById('remark').value,
            };

            if (operatorData.shift && operatorData.soOperator && operatorData.idOperator) {
                await addDoc(collection(db, 'operatorsOnDuty'), operatorData);
                clearOperatorFields();
            } else {
                alert('Please fill in all required fields.');
            }
        });

        function clearOperatorFields() {
            document.getElementById('shift').value = '';
            document.getElementById('soOperator').value = '';
            document.getElementById('idOperator').value = '';
            document.getElementById('supervisor').value = '';
            document.getElementById('remark').value = '';
        }

         // Event delegation for handling edit and delete buttons
         document.getElementById('ondutysection').addEventListener('click', async (event) => {
            if (event.target.classList.contains('deleteButton') && userRole === 'supervisor') {
                const id = event.target.getAttribute('data-id');
                if (confirm("Are you sure you want to delete this entry?")) {
                    await deleteDoc(doc(db, 'operatorsOnDuty', id));
                }
            }

            if (event.target.classList.contains('editButton') && userRole === 'supervisor') {
                const id = event.target.getAttribute('data-id');
                const docRef = doc(db, 'operatorsOnDuty', id);
                const docSnap = await getDoc(docRef);
                const operator = docSnap.data();

                document.getElementById('editShift').value = operator.shift;
                document.getElementById('editSOOperator').value = operator.soOperator;
                document.getElementById('editIDOperator').value = operator.idOperator;
                document.getElementById('editSupervisor').value = operator.supervisor || '';
                document.getElementById('editRemark').value = operator.remark || '';

                currentEditId = id;
                document.getElementById('editModal').style.display = 'block'; // Show the edit modal
            }
        });

        // Save changes when the save button in the edit modal is clicked
        document.getElementById('saveEditBtn').addEventListener('click', async () => {
            if (currentEditId) {
                const updatedData = {
                    shift: document.getElementById('editShift').value,
                    soOperator: document.getElementById('editSOOperator').value,
                    idOperator: document.getElementById('editIDOperator').value,
                    supervisor: document.getElementById('editSupervisor').value,
                    remark: document.getElementById('editRemark').value,
                };

                await updateDoc(doc(db, 'operatorsOnDuty', currentEditId), updatedData);
                clearEditFields();
                currentEditId = "";
                document.getElementById('editModal').style.display = 'none'; // Hide after saving
            }
        });

        function clearEditFields() {
            document.getElementById('editShift').value = '';
            document.getElementById('editSOOperator').value = '';
            document.getElementById('editIDOperator').value = '';
            document.getElementById('editSupervisor').value = '';
            document.getElementById('editRemark').value = '';
        }

        // Close modal when clicking on X
        document.querySelector('.close').onclick = function () {
            currentEditId = "";
            document.getElementById('editModal').style.display = 'none'; // Ensure modal hides
        };
        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0'); // Ensures two digits
            const minutes = String(now.getMinutes()).padStart(2, '0'); // Ensures two digits
            const seconds = String(now.getSeconds()).padStart(2, '0'); // Ensures two digits
            const timeString = `${hours}:${minutes}:${seconds}`;

            document.getElementById('clock').textContent = timeString; // Display the time
        }

        // Toggle Operators on Duty visibility and details
        const operatorsButton = document.getElementById('viewondutyBtn');

        operatorsButton.addEventListener('mouseenter', () => {
            operatorsButton.style.backgroundColor = '#0056b3'; // Change to a darker blue
        });

        operatorsButton.addEventListener('mouseleave', () => {
        operatorsButton.style.backgroundColor = '#007BFF'; // Revert to original blue
        });

        operatorsButton.addEventListener('click', () => {
            const operatorsHeader = document.getElementById('operatorsHeader');
            const clock = document.getElementById('clock');
            const tablesDiv = document.getElementById('tablesDiv');

            // Display header and clock
            if (operatorsHeader.style.display === 'none') {
                operatorsHeader.style.display = 'block'; // Show the Operators header
                clock.style.display = 'block'; // Show the clock
                tablesDiv.style.display = 'block'; // Show tables
                updateTime(); // Update time immediately
            } else {
                operatorsHeader.style.display = 'none'; // Hide it
                clock.style.display = 'none'; // Hide clock
                tablesDiv.style.display = 'none'; // Hide tables
            }
        });

        setInterval(updateTime, 1000); // Update the time every second
        updateTime(); // Initial call to display the time immediately
    </script>
</body>

</html>
